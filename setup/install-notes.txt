#install notes for Ubuntu 12.04

#change Apache default port:
sudo vim /etc/apache2/sites-available/default
sudo vim /etc/apache2/ports.conf
sudo /etc/init.d/apache2 restart

#clone the application from the home directory
git clone git@bitbucket.org:deccico/capego.git

sudo apt-get install python-pip

#django install
sudo pip install django

#postgresql
#source: https://help.ubuntu.com/community/PostgreSQL
sudo apt-get install postgresql-client
sudo apt-get install postgresql
sudo -u postgres psql
\password postgres

createdb capego
sudo -u postgres createdb mydb

sudo apt-get install postgresql-server-dev-all
sudo apt-get install python-dev
sudo vim /etc/postgresql/9.1/main/pg_hba.conf
    set this line:
    local   all             postgres                                md5
sudo /etc/init.d/postgresql restart


#python postgres binding
sudo pip install psycopg2

#social auth
#http://django-social-auth.readthedocs.org/en/latest/configuration.html
#http://django-social-auth.readthedocs.org/en/latest/backends/facebook.html
#http://django-social-auth.readthedocs.org/en/latest/backends/google.html#google-openid
#http://django-social-auth.readthedocs.org/en/latest/backends/openid.html
sudo pip install django-social-auth

#memcache configuration
#https://docs.djangoproject.com/en/dev/topics/http/sessions/
#https://docs.djangoproject.com/en/dev/topics/cache/
sudo apt-get install memcached
sudo pip install python-memcached
#------------------------

Fix settings in capego/capego/local_settings.py

#nginx
sudo apt-get install python-software-properties
sudo add-apt-repository ppa:nginx/stable
sudo mkdir -p /opt/django/logs/nginx
sudo chown -R ubuntu  /opt/
ln -s ~/capego/static/ /opt/django/
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.backup
sudo cp capego/setup/nginx/sites-available/default /etc/nginx/sites-available/default
sudo service nginx restart
test: http://[192.211.54.166]/static/img/logo.png

#upstart and logs
sudo cp ~/capego/setup/bin/capego.conf /etc/init/
chmod -R a+rwx ~/capego/capego/log/

#set up db
sudo start capego
./manage.py syncdb
db/reset_and_load_data.sh


#in case we need to start / stop
sudo stop capego
sudo start capego
